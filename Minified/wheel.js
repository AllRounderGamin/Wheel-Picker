const WHEELTEMP=document.createElement("template");WHEELTEMP.innerHTML='<link href="./stylesheet.css" rel="stylesheet"> <div class="container"> <div class="wheelContainer"> <canvas class="wheelCanvas" width="400" height="400"></canvas> <canvas class="pointerCanvas" width="400" height="400"></canvas> </div><div class="buttonGroup"> <button class="spinButton" type="button">Spin Wheel</button> <button class="deleteButton" type="button">Delete Wheel</button> <button class="settingsButton" type="button">Settings</button> </div></div>';const M=Math.PI;class fortuneWheel extends HTMLElement{constructor(){super(),this.CA=0,this.C=[],this.I=[],this.initialise()}initialise(){this.S=this.attachShadow({mode:"open"}),this.S.appendChild(WHEELTEMP.content.cloneNode(!0)),this.W=this.S.querySelector(".wheelCanvas"),this.WC=this.W.getContext("2d"),this.S.querySelector(".spinButton").addEventListener("click",this.spinWheel.bind(this)),this.S.querySelector(".deleteButton").addEventListener("click",this.deleteWheel.bind(this)),this.drawPointer()}static get observedAttributes(){return["customising"]}attributeChangedCallback(){this.getValues(),this.drawWheel()}getValues(){this.I=JSON.parse(this.getAttribute("items")),this.C=JSON.parse(this.getAttribute("colors"))}drawWheel(){this.WC.clearRect(0,0,this.W.height,this.W.width),this.AS=2*M/this.I.length;let a=0;this.WC.font="32px serif",this.WC.textBaseline="middle";for(let b=0;b<this.I.length;b++)this.WC.fillStyle=this.C[b],this.WC.beginPath(),this.WC.arc(200,200,150,a-M/2,a+this.AS-M/2),this.WC.lineTo(200,200),this.WC.fill(),this.WC.closePath(),a+=this.AS,this.I.length<10&&(this.WC.save(),this.WC.translate(this.W.width/2,this.W.height/2),this.WC.rotate(-M/2+(a-this.AS/2)),this.WC.fillStyle="black",this.WC.fillText("     "+this.I[b],0,0,130),this.WC.restore())}drawPointer(){let a=this.S.querySelector(".pointerCanvas");this.PC=a.getContext("2d"),this.PC.fillStyle="black",this.PC.beginPath(),this.PC.moveTo(380,185),this.PC.lineTo(380,215),this.PC.lineTo(350,200),this.PC.fill()}spinWheel(){let a=1080+360*Math.random();this.W.style.setProperty("--s",this.CA+"deg"),this.W.style.setProperty("--e",Math.floor(this.CA+a)+"deg"),this.W.classList.toggle("active"),this.CA=Math.floor(this.CA+a)%360,this.W.style.setProperty("--r",this.CA+"deg"),this.W.addEventListener("animationend",this.verifyAnswer.bind(this),{once:!0})}verifyAnswer(){this.W.classList.toggle("active");let b=Math.floor((450-this.CA)%360*M/180/this.AS);this.PC.clearRect(0,300,400,100),this.PC.font="32px serif";let a="Winner is "+this.I[b],c=200-this.PC.measureText(a).width/2;this.PC.strokeText(a,c,385,360),this.PC.fillStyle=this.C[b],this.PC.fillText(a,c,385,360)}deleteWheel(){let a=JSON.parse(localStorage.getItem("wheels"));for(let c of a)c.id===this.getAttribute("id")&&a.splice(a.indexOf(c),1);let b=document.querySelector("#settingsArea");for(;b.hasChildNodes();)b.removeChild(b.firstChild);localStorage.setItem("wheels",JSON.stringify(a)),this.shadowRoot.host.remove()}}customElements.define("wheel-picker",fortuneWheel)
